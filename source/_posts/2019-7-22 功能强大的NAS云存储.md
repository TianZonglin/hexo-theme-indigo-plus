date: 2019-7-22
categories: 建站组网
tags: [组网,路由,Synology,HTPC]
comments: true
title: 功能强大的NAS云存储

---

> 注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考

![image_1dh5p391q14c9igi1pu51jrj6sqm.png-790.9kB][1]

### 初识NAS

NAS，Network Attached Storage，直译是网络附属存储，但实际上就是一种网络存储器，一般常见的存储设备如3.5寸的机械硬盘（用于台式机）、2.5寸的机械硬盘（用于笔记本或移动硬盘）、固态硬盘、U盘等，各种类型的硬盘接口规格都不相同，有SATA、mSATA、PCI-E、mini-PCIE等等，目前都支持相互转接。

需要强调的是，上述硬盘（存储器）通过硬件插槽或者传输线直接连到电脑主板、然后开机识别出硬盘空间这种流程，是一般存储器的使用方式，其要求硬盘和主机不能存在地理隔离（即便使用传输线也有距离限制），且这种情况下主机向外提供数据只能在上层应用中实现，这限制了设备的可扩展性和灵活性。网络存储器应运而生，其发展速度非常迅速，后期又伴随着硬件虚拟化技术的发展，衍生出了若干种网络传输协议（NFS、iSCSI等），对于家用NAS来说，主要使用NFS（还有SMB）。

为了提供相关服务（协议），NAS通常具备主控（主板）模块，其不再是单纯的硬盘堆叠（硬盘盒或硬盘架），而是对硬盘空间的有效组织，目前市面上存在包括FreeNAS（开源）和Synology的DSM（群晖的闭源系统）在内的多种NAS系统，商业化比较成功的厂家有Synology（群晖）、QNAP（威联通）等，其产品核心价值在于 主板 + 系统，硬件层面没有限制，故而允许通过第三方主板硬件刷入群晖系统来使用，通常这种机器称为“黑群晖”，在某些功能上有许多限制，后续可以通过相关操作进行“洗白”，这样可以用更强的硬件设备搭载群晖的系统从而获得更好的性价比（白群晖价格有相当一部分摊到了系统上），当然这是不正确的、盗版的行为，商用会被追究法律责任。支持正版从我做起。

### NAS的特点

- 有主（控）板，带有内存插槽、网卡网口、CPU、显卡（一般是集显）、USB等等
- 有若干盘位，一般最少是 2 盘位，插入3.5寸机械硬盘
- 基于多种网络协议，包括NFS、SMB等等，一根网线即可让任何位置的电脑通过网络访问硬盘空间
- 提供上层应用，包括多媒体的编码解码，进而可向外提供丰富的流媒体资源

### NAS可能的日常使用场景

#### 多媒体

- **视频**：NAS端（异地）下载，本地观看。例如身在学校内，每月流量有限，NAS在家中，家中宽带无限制，这时通过远程下载，可以在学校内观看经过编码后的视频流，一是借助家里的大带宽的高网速加速下载过程，二可以通过编解码后的多媒体资源会占用更小的空间（使用更少流量），而实质上的观看体验肉眼基本不可见。上述内容实现需要NAS端的带宽有足够大的上行，一般＞20Mbps即可。
- **音频**：可用作珍贵资源保存，同时也提供完备的音频在线解码服务，可以用类似QQ音乐的方式来访问NAS中的音频文件。
- **图片**：这是NAS的重要功能之一，也是群晖的重要功能之一，为此官方套件有两个是针对图片管理的。从我们使用智能手机、数码相机的第一天开始，我们的手机里、相机里就存满了我们的照片，如何管理是个大问题，一般我们直接存在电脑的某硬盘里就可以，但如果我们想随时随地翻看过去某一天的某张照片、或是在公网环境浏览我们的全部照片，那一般的保存就不够用了，需要专门的照片管理软件，在这里，群晖提供了丰富的照片管理软件，不仅可以很好的对图片进行重新组织；同时，也提供照片的对外发布服务。
- **电子书**：附加功能。Kindle重度用户会比较感兴趣，一般是依靠第三方的docker套件完成。

#### 网盘系统

或者叫私有网盘（私有云）。目前，群晖可以快速搭建可道云（KodExplorer）基础版，基础版可道云已完全能够满足个人使用，使用上同115等云盘基本一样，只是所有文件均存储在NAS中，故名“私有云”。上述内容实现需要NAS端下行带宽要大，一般需要50Mbps以上。

### 上述对应的实现方式

需注意：基于群晖的各功能可由以下几种方式提供：

- **官方随机套件**（系统安装后的套件中心内默认列表）
- **附加套件**（同样在套件中心内，但需要手动添加第三方源，之后才能扫描到套件列表）
- **docker应用**（强大的功能！可搜素到99%的docker镜像并安装，但需注意要专门为群晖做过适配的镜像才能正常使用：一般必须得配置端口映射+存储空间的映射）
- **Web Station自建应用**（Web Station套件实际上是群晖提供的具有php + apache server/nginx + mysql 建站环境的套件，显而易见，其可以支持自定义的网站搭建。WordPress等Web应用均可搭建）
- **Virtual Machine**（利用群晖的虚拟机套件可安装Win7、XP等系统，作用等同于VMware或VritualBox）

#### 多媒体
- **视频**： 
    - 下载：
        - BT资源下载：Download Station（官方套件）、thunder-xware（docker应用）、Transmission（docker应用）、qBittorrent（docker应用）。（一般用Download Station下载即可，若无下载速度则可能是种子原因）
        - 百度网盘资源下载：baidupcs（docker应用）、CloudSync（官方同步套件，利用指定文件夹的同步进行下载）
        - 人人影视：专职美剧英剧的字幕翻译、压制及发布，群晖上可使用 rrshare（docker应用）
    - 串流：可通过群晖自带的 Video Station 或者第三方PLEX（Server）实现。
    - 客户端：手机应用（DS Video、Plex），电脑使用（DSV只能用Web页面访问，而Plex在Web之外还有独立的桌面应用）
- **音频**：
    -  下载：除了以文件形式的下载外（BT下载或百度网盘下载），还未发现专门的音乐下载应用，目前采用的方式是电脑用QQ音乐、网易云音乐等下载音乐文件，然后上传到群晖NAS中，一般音乐使用场景较少，不过可以当做稀有资源的备份（越来越多的歌曲正在下架）
    -  串流：使用官方套件 Audio Station 或者第三方PLEX实现
    -  客户端：手机应用（DS Audio、PLEX），电脑使用（对应的Web页面）

- **图片（照片）**：
    - 一般由本地上传，系个人拍照、摄影、截图等等
    - 组织管理：
        - Photo Station，官方套件，提供时间线、地图坐标等视图，占用资源较小，功能较单一；
        - Moments，官方套件，已被集成在Drive（官方网盘套件）中，提供主题分析、地点分类等功能，占用资源较多，功能丰富，若使用Drive则推荐使用Moments，否则可只用Photo Station
        - PLEX，主要用于媒体资源管理，同样支持照片的管理
    - 客户端：前两者对应官方套件，后者是PLEX客户端，三者均可通过Web页面访问
- **电子书（Kindle）**：
    - 最近购入了Kindle，有必要说下电子书的下载，采用 my-calibre-webserver（docker应用）可自建一个图书管理系统，其带有电子书推送功能，可以将指定书目推送到Kindle上。 


#### 网盘系统

- **Drive**：群晖官方套件，这是同其他官方套件（Moments、CloudSync等）高度耦合的一款网盘服务套件，其可以实现文件的上传、下载、文档的多人协作、版本控制等等功能，功能丰富，但占用资源较大，版本控制也容易产生大量垃圾文件，因此我并没有使用该套件（对应的我也没用Moments）。
- **KodExplorer**：可道云（第三方）套件，该套件为用户搭建了一个基础版的可道云服务，可道云在使用上同一般网盘无异，同时提供简洁的Kod云手机APP应用，本质上是利用Web Station搭建的一个Web应用，故而相对独立，占用资源也较少，因此我使用了该套件搭建网盘系统。



#### 附：我的应用

下面是目前我使用的全部套件/应用 → 以及对应的手机端应用

- 远程管理
    - DSM → Web
    - WebSSH → Web
- 文本（简单上传下载）
    - File Station → DS File APP
    - FTP → WinSCP（PC）
- 音乐视频（解码、在线播放）
    - Video Station → DS Video APP
    - Audio Station → DS Audio APP
    - PLEX Server → PLEX APP
- 图片照片（管理、重新组织）
    - Photo Station → DS Photo APP
    - Moments → Moments APP（我没用）
- 上层应用
    - 文件的上传下载/云盘映射
        - Webdev → 服务
        - Cloud Sync → DSM内操作
        - KodExplore → KodExplore APP
    - 电影的下载
        - 迅雷远程 → Web
        - 人人Web版 → Web
        - 百度网盘Web版 → Web
        - Download Station → DS Get APP
    - 电子书的下载
        - kindle图书管理Web版  → Web
    - 网站环境
        - Nginx → 服务
        - Apache Server → 服务
        - Tomcat → 服务
        - PHP 5-7 → 服务
    - 扩展容器
        - 第三方套件源
        - Virtual Machine → DSM内操作
        - Docker → DSM内操作

承载以上内容的设备的各项基本信息：

- **产品型号**：DS418play
- **CPU**：Intel Celeron J3355, 2GHz × 2
- **内存**：6 GB
- **DSM版本**：DSM 6.2.1-23824 Update 6

---

弄清楚上述应用的使用方式后，还有最最最最重要的一点，即外网访问。对于绝大多数家庭用户，其NAS均放在路由器之后，即NAS处于家庭子网（局域网）内，正常是无法在公网环境中直接访问到的。如何做？自然地想到公网环境应该可以直接访问到家中的路由器，但真的访问的到吗？关于家庭网络的若干问题，请参见下一篇文章内容。



  [1]: http://static.zybuluo.com/EVA001/bhza86an7ou0de5f7s46cphf/image_1dh5p391q14c9igi1pu51jrj6sqm.png


