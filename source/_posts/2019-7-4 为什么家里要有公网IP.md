date: 2019-7-4
categories: 建站组网
tags: [组网,路由,Synology]
comments: true
title: 为什么家里要有公网IP

---

最近家里换了宽带，并且在我的强烈要求下选择了能提供公网IP的联通宽带，当然这里是动态公网IP，期间，包括光猫的桥接+路由器拨号，都已经做完，基本上到这里为止家里的网络环境就是外部可访问的了，从此可以抛弃内网穿透，直连站起来重新做人了。为什么要折腾外部访问呢，因为我把群晖放家里了，自然是想随时随地访问一下子的，现在有了公网IP，虽然是动态的，但只需在群晖的DDNS页面配置下，就可以使用域名进行访问了，非常的方便和舒服，速度快的飞起来。欢迎访问ZoneCloud -> http://zara.asuscomm.com:5000/

![image_1df129t0skup15hqvvtlga1ls1m.png-97.9kB][1]

下面就安装宽带的注意事项做一下记录：

### 宽带商的选择

一般只有三种选择，联通、移动和电信，其中移动手中有的IP资源是最少的，这是事实，但对于宽带是否提供（动态）公网IP，这在不同地域或有差别，但移动肯定是最不靠谱的一家；剩下的两家没太听到过槽点，所以酌情看套餐办理吧。

### 安装过程的操作

一般装宽带是得安装师傅本身到家里来装的，且现在基本是光纤入户，所以“光猫”是必不可少的一个硬件，主要完成的是光信号转换的任务（部分高端路由器也可以完成光信号转换）。一般而言，正常的上网流程是光纤入户后，在光猫处随机完成拨号上网，这种方式的缺点是：

光猫作为家庭网络同外部网络沟通的最后一层，端口转发工作应在最外层即这一层完成，在此处，光猫得完成端口转发的工作，但要命的是光猫并不是路由器，无法替代路由工作，家里的设备总归要通过路由器汇集。这时问题来了，光猫拨号的前提下，路由器变为了二级路由，端口映射会变得非常复杂，DMZ+端口映射或许可以解决问题，但并不完美。

真正方便快捷的方式是**在安装时让师傅改光猫为桥接**，这样光猫的功能退化为单一的光信号转换，而拨号、端口映射等任务全部交给路由器完成（**稍高端的路由器均可支持**），此时的网络结构，虽然光猫仍然是最前沿的阵地，但实际对网路信号而言路由器成了排头兵，所有的内外交换数据均通过路由器协调、中转，光猫只是开闸放水不加以任何干涉。

此时，在路由器上设置的端口转发，会直接作用到IP上，即整个环境中只有一级路由，非常清晰和方便，类似群晖这类存储系统的外部访问，只需在路由上配置一连串的端口映射，即可以通过**IP+端口**的形式在公网环境中进行访问了。

![image_1df4djnaubjpjrg1jn91cvnnbs9.png-379.8kB][2]
### 关于动态公网IP的变动

固定公网IP的宽带业务一般叫“专线”，属于企业宽带的范畴，动辄月付几百大洋，和普通家用宽带年付几百块相比要贵的多得多，所以，这里讨论的都是基于动态公网IP的各种操作。

顾名思义，动态公网IP的IP地址是会变的，但变前和变后均为公网IP，变动的时机往往是重新拨号上网后，这和路由器的动态分配IP是一样的，每次断开重连都会回收原有IP并分配新的IP，但在分配后，设备会一直独占此IP，因此如果不是经常断电重启，那么动态公网IP也可以看作是短时的固定IP。

但是，可能变化的IP对于外部访问是非常困扰的，例如你跟朋友刚分享了自己看的电影，结果下午你朋友通过IP就访问不到了（可能是经历了路由器重新拨号），杜绝这一现象的手段就是，将多变的IP绑定到单一固定的域名上，这样，在访问该域名时，即会解析到当前的IP（IP同域名之间的绑定关系会一直更新），整个上述过程即叫做**DDNS**，即动态域名解析。

相比于域名解析，这里的动态体现在域名映射的IP地址不固定，而是变化的，而对于域名同IP的映射的更新，是群晖提供的DDNS功能中的一部分。12即，除了群晖（必须为白群）提空的DDS服务之外，使用阿里云等DNS域名解析服务也能完成此功能，只是可能需要自己来实现“动态绑定”的功能。

----

### 写在最后

暂时写到这里，换了宽带只是万里长征第一步，只是，原来可能通过FRP内网穿透来访问的东西（非常慢），现在直接访问就行了，现在一步顶原来十步，果然是科技改变生活。关于其他的各种公网IP具备的或者是带来的功能及玩法，在以后有时间在写！


### 补充一：使用人人影视Web版来批量下载剧集

![image_1df4dvd9914s01dglqg71sc75cqm.png-84.6kB][3]

这里采用的是在镜像库中评价最好的`oldiy/rrshare64`（第一个），使用方式很简单，在注册表找到并选中点击下载，在映像中能够找到它，然后双击可以弹出设置页面，初始可以不进行配置，直接点击下一步到最后，之后docker镜像会自动启动，然后在容器中就可以看到它了。

![image_1df4efrc3patd03hpd1sd41jq13.png-136.9kB][4]

对该镜像的配置需要首先停止其运行，然后点击上方的`编辑`按钮即可进入配置页，**重中之重是对“卷”的配置**，这个直接关系到下载文件所在的位置。如上图红圈所示的路径和配置页是一致的，这里要注意：

- 左侧的`文件/文件夹` 对应群晖中文件系统的路径（**必须是FileStation可见的路径**）
- 右侧的`装在路径` 对应Web页面的设置中的下载路径（默认就是**/opt/work/store**）

一定要注意对应关系，在这个地方浪费了好多时间。上述内容需要在配置页的“卷”这页，手动新建一个并配置（**默认是空的，下载文件会找不到**）

![image_1df4errtmms8bnh2h109k5ch1s.png-57.2kB][5]

上述配置过程结束后整个配置过程就完成了，然后就是使用人人Web端进行批量下载了，网站非常易用，下载页很给力，经过路径配置后，可以在`FileStation`中找到对应的文件，可以把上级文件夹绑定到`Plex`或者`DSVideo`的视频列表中，这样就可以下载转码一条龙搞定了！


![image_1df4f385t1rnie1jmd7fpo14lq29.png-129kB][6]


  [1]: http://static.zybuluo.com/EVA001/l0ciduavm4enuui0hzfi7un9/image_1df129t0skup15hqvvtlga1ls1m.png
  [2]: http://static.zybuluo.com/EVA001/jk8y1zf8tonjbtdpmo9quy98/image_1df4djnaubjpjrg1jn91cvnnbs9.png
  [3]: http://static.zybuluo.com/EVA001/tzc3q8d0fdy4b366ydv0shlr/image_1df4dvd9914s01dglqg71sc75cqm.png
  [4]: http://static.zybuluo.com/EVA001/5tfcet7ej29ondaxnsxk6rtk/image_1df4efrc3patd03hpd1sd41jq13.png
  [5]: http://static.zybuluo.com/EVA001/likcfthtvcn9jcfh27p0ukzw/image_1df4errtmms8bnh2h109k5ch1s.png
  [6]: http://static.zybuluo.com/EVA001/jq1fuy4w7vcl1nqadmf2c2wo/image_1df4f385t1rnie1jmd7fpo14lq29.png